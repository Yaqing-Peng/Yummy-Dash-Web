{"remainingRequest":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/src/views/setmeal/addSetmeal.vue?vue&type=template&id=c313e5f0","dependencies":[{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/src/views/setmeal/addSetmeal.vue","mtime":1712106502666},{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/vue-loader/lib/loaders/templateLoader.js","mtime":499162500000},{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jasmine/Desktop/projects/vue-proj/yummy-dash-admin-vue-ts/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n  <div class=\"addBrand-container\">\n    <div class=\"container\">\n      <el-form ref=\"ruleForm\"\n               :model=\"ruleForm\"\n               :rules=\"rules\"\n               :inline=\"true\"\n               label-width=\"180px\"\n               class=\"demo-ruleForm\">\n        <div>\n          <el-form-item label=\"Setmeal Name:\"\n                        prop=\"name\">\n            <el-input v-model=\"ruleForm.name\"\n                      placeholder=\"Please enter the setmeal name\"\n                      maxlength=\"14\" />\n          </el-form-item>\n          <el-form-item label=\"Setmeal Category:\"\n                        prop=\"idType\">\n            <el-select v-model=\"ruleForm.idType\"\n                       placeholder=\"Please select a setmeal category\"\n                       @change=\"$forceUpdate()\">\n              <el-option v-for=\"(item, index) in setMealList\"\n                         :key=\"index\"\n                         :label=\"item.name\"\n                         :value=\"item.id\" />\n            </el-select>\n          </el-form-item>\n        </div>\n        <div>\n          <el-form-item label=\"Setmeal Price:\"\n                        prop=\"price\">\n            <el-input v-model=\"ruleForm.price\"\n                      placeholder=\"Please set the setmeal price\" />\n          </el-form-item>\n        </div>\n        <div>\n          <el-form-item label=\"Setmeal Dishes:\"\n                        required>\n            <el-form-item>\n              <div class=\"addDish\">\n                <span v-if=\"dishTable.length == 0\"\n                      class=\"addBut\"\n                      @click=\"openAddDish('new')\">\n                  + Add Dishes</span>\n                <div v-if=\"dishTable.length != 0\"\n                     class=\"content\">\n                  <div class=\"addBut\"\n                       style=\"margin-bottom: 20px\"\n                       @click=\"openAddDish('change')\">\n                    + Add Dishes\n                  </div>\n                  <div class=\"table\">\n                    <el-table :data=\"dishTable\"\n                              style=\"width: 100%\">\n                      <el-table-column prop=\"name\"\n                                       label=\"Name\"\n                                       width=\"180\"\n                                       align=\"center\" />\n                      <el-table-column prop=\"price\"\n                                       label=\"Original Price\"\n                                       width=\"180\"\n                                       align=\"center\">\n                        <template slot-scope=\"scope\">\n                          {{ (Number(scope.row.price).toFixed(2) * 100) / 100 }}\n                        </template>\n                      </el-table-column>\n                      <el-table-column prop=\"address\"\n                                       label=\"Portions\"\n                                       align=\"center\">\n                        <template slot-scope=\"scope\">\n                          <el-input-number v-model=\"scope.row.copies\"\n                                           size=\"small\"\n                                           :min=\"1\"\n                                           :max=\"99\"\n                                           label=\"Description Text\" />\n                        </template>\n                      </el-table-column>\n                      <el-table-column prop=\"address\"\n                                       label=\"Operation\"\n                                       width=\"180px;\"\n                                       align=\"center\">\n                        <template slot-scope=\"scope\">\n                          <el-button type=\"text\"\n                                     size=\"small\"\n                                     class=\"delBut non\"\n                                     @click=\"delDishHandle(scope.$index)\">\n                            Delete\n                          </el-button>\n                        </template>\n                      </el-table-column>\n                    </el-table>\n                  </div>\n                </div>\n              </div>\n            </el-form-item>\n          </el-form-item>\n        </div>\n        <div>\n          <el-form-item label=\"Setmeal Image:\"\n                        required\n                        prop=\"image\">\n            <image-upload :prop-image-url=\"imageUrl\"\n                          @imageChange=\"imageChange\">\n              Image size must not exceed 2MB<br>Only PNG, JPEG, JPG formats are allowed<br>It is recommended to upload an image of size 200*200 or 300*300\n            </image-upload>\n          </el-form-item>\n        </div>\n        <div class=\"address\">\n          <el-form-item label=\"Setmeal Description:\">\n            <el-input v-model=\"ruleForm.description\"\n                      type=\"textarea\"\n                      :rows=\"3\"\n                      maxlength=\"200\"\n                      placeholder=\"Setmeal description, up to 200 characters\" />\n          </el-form-item>\n        </div>\n        <div class=\"subBox address\">\n          <el-form-item>\n            <el-button @click=\"() => $router.back()\">\n              Cancel\n            </el-button>\n            <el-button type=\"primary\"\n                       :class=\"{ continue: actionType === 'add' }\"\n                       @click=\"submitForm('ruleForm', false)\">\n              Save\n            </el-button>\n            <el-button v-if=\"actionType == 'add'\"\n                       type=\"primary\"\n                       @click=\"submitForm('ruleForm', true)\">\n              Save and Continue Adding\n            </el-button>\n          </el-form-item>\n        </div>\n      </el-form>\n    </div>\n    <el-dialog v-if=\"\n\n\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator'\nimport HeadLable from '@/components/HeadLable/index.vue'\nimport ImageUpload from '@/components/ImgUpload/index.vue'\nimport AddDish from './components/AddDish.vue'\nimport { querySetmealById, addSetmeal, editSetmeal } from '@/api/setMeal'\nimport { getCategoryList } from '@/api/dish'\nimport { baseUrl } from '@/config.json'\n\n@Component({\n  name: 'addShop',\n  components: {\n    HeadLable,\n    AddDish,\n    ImageUpload\n  }\n})\nexport default class extends Vue {\n  private value: string = ''\n  private setMealList: [] = []\n  private seachKey: string = ''\n  private dishList: [] = []\n  private imageUrl: string = ''\n  private actionType: string = ''\n  private dishTable: [] = []\n  private dialogVisible: boolean = false\n  private checkList: any[] = []\n  private ruleForm = {\n    name: '',\n    categoryId: '',\n    price: '',\n    code: '',\n    image: '',\n    description: '',\n    dishList: [],\n    status: true,\n    idType: ''\n  }\n\n  get rules() {\n    return {\n      name: {\n        required: true,\n        validator: (rule: any, value: string, callback: Function) => {\n          if (!value) {\n            callback(new Error('请输入套餐名称'))\n          } else {\n            const reg = /^([A-Za-z0-9\\u4e00-\\u9fa5]){2,20}$/\n            if (!reg.test(value)) {\n              callback(new Error('套餐名称输入不符，请输入2-20个字符'))\n            } else {\n              callback()\n            }\n          }\n        },\n        trigger: 'blur'\n      },\n      idType: {\n        required: true,\n        message: '请选择套餐分类',\n        trigger: 'change'\n      },\n      image: {\n        required: true,\n        message: '菜品图片不能为空'\n      },\n      price: {\n        required: true,\n        // 'message': '请输入套餐价格',\n        validator: (rules: any, value: string, callback: Function) => {\n          const reg = /^([1-9]\\d{0,5}|0)(\\.\\d{1,2})?$/\n          if (!reg.test(value) || Number(value) <= 0) {\n            callback(\n              new Error(\n                '套餐价格格式有误，请输入大于零且最多保留两位小数的金额'\n              )\n            )\n          } else {\n            callback()\n          }\n        },\n        trigger: 'blur'\n      },\n      code: { required: true, message: '请输入商品码', trigger: 'blur' }\n    }\n  }\n\n  created() {\n    this.getDishTypeList()\n    this.actionType = this.$route.query.id ? 'edit' : 'add'\n    if (this.actionType == 'edit') {\n      this.init()\n    }\n  }\n\n  private async init() {\n    querySetmealById(this.$route.query.id).then(res => {\n      if (res && res.data && res.data.code === 1) {\n        this.ruleForm = res.data.data\n        this.ruleForm.status = res.data.data.status == '1'\n        ;(this.ruleForm as any).price = res.data.data.price\n        // this.imageUrl = `http://172.17.2.120:8080/common/download?name=${res.data.data.image}`\n        this.imageUrl = res.data.data.image\n        this.checkList = res.data.data.setmealDishes\n        this.dishTable = res.data.data.setmealDishes.reverse()\n        this.ruleForm.idType = res.data.data.categoryId\n      } else {\n        this.$message.error(res.data.msg)\n      }\n    })\n  }\n  private seachHandle() {\n    this.seachKey = this.value\n  }\n  // 获取套餐分类\n  private getDishTypeList() {\n    getCategoryList({ type: 2, page: 1, pageSize: 1000 }).then(res => {\n      if (res && res.data && res.data.code === 1) {\n        this.setMealList = res.data.data.map((obj: any) => ({\n          ...obj,\n          idType: obj.id\n        }))\n      } else {\n        this.$message.error(res.data.msg)\n      }\n    })\n  }\n\n  // 通过套餐ID获取菜品列表分类\n  // private getDishList (id:number) {\n  //   getDishListType({id}).then(res => {\n  //     if (res.data.code == 200) {\n  //       const { data } = res.data\n  //       this.dishList = data\n  //     } else {\n  //       this.$message.error(res.data.desc)\n  //     }\n  //   })\n  // }\n\n  // 删除套餐菜品\n  delDishHandle(index: any) {\n    this.dishTable.splice(index, 1)\n    this.checkList = this.dishTable\n    // this.checkList.splice(index, 1)\n  }\n\n  // 获取添加菜品数据 - 确定加菜倒序展示\n  private getCheckList(value: any) {\n    this.checkList = [...value].reverse()\n  }\n\n  // 添加菜品\n  openAddDish(st: string) {\n    this.seachKey = ''\n    this.dialogVisible = true\n  }\n  // 取消添加菜品\n  handleClose(done: any) {\n    // this.$refs.adddish.close()\n    this.dialogVisible = false\n    this.checkList = JSON.parse(JSON.stringify(this.dishTable))\n    // this.dialogVisible = false\n  }\n\n  // 保存添加菜品列表\n  public addTableList() {\n    this.dishTable = JSON.parse(JSON.stringify(this.checkList))\n    this.dishTable.forEach((n: any) => {\n      n.copies = 1\n    })\n    this.dialogVisible = false\n  }\n\n  public submitForm(formName: any, st: any) {\n    ;(this.$refs[formName] as any).validate((valid: any) => {\n      if (valid) {\n        if (this.dishTable.length === 0) {\n          return this.$message.error('套餐下菜品不能为空')\n        }\n        if (!this.ruleForm.image) return this.$message.error('套餐图片不能为空')\n        let prams = { ...this.ruleForm } as any\n        prams.setmealDishes = this.dishTable.map((obj: any) => ({\n          copies: obj.copies,\n          dishId: obj.dishId,\n          name: obj.name,\n          price: obj.price\n        }))\n        ;(prams as any).status =\n          this.actionType === 'add' ? 0 : this.ruleForm.status ? 1 : 0\n        prams.categoryId = this.ruleForm.idType\n        // delete prams.dishList\n        if (this.actionType == 'add') {\n          delete prams.id\n          addSetmeal(prams)\n            .then(res => {\n              if (res && res.data && res.data.code === 1) {\n                this.$message.success('套餐添加成功！')\n                if (!st) {\n                  this.$router.push({ path: '/setmeal' })\n                } else {\n                  ;(this as any).$refs.ruleForm.resetFields()\n                  this.dishList = []\n                  this.dishTable = []\n                  this.ruleForm = {\n                    name: '',\n                    categoryId: '',\n                    price: '',\n                    code: '',\n                    image: '',\n                    description: '',\n                    dishList: [],\n                    status: true,\n                    id: '',\n                    idType: ''\n                  } as any\n                  this.imageUrl = ''\n                }\n              } else {\n                this.$message.error(res.data.msg)\n              }\n            })\n            .catch(err => {\n              this.$message.error('请求出错了：' + err.message)\n            })\n        } else {\n          delete prams.updateTime\n          editSetmeal(prams)\n            .then(res => {\n              if (res.data.code === 1) {\n                this.$message.success('套餐修改成功！')\n                this.$router.push({ path: '/setmeal' })\n              } else {\n                // this.$message.error(res.data.desc || res.data.message)\n              }\n            })\n            .catch(err => {\n              this.$message.error('请求出错了：' + err.message)\n            })\n        }\n      } else {\n        // console.log('error submit!!')\n        return false\n      }\n    })\n  }\n\n  imageChange(value: any) {\n    this.ruleForm.image = value\n  }\n}\n</script>\n<style>\n.avatar-uploader .el-icon-plus:after {\n  position: absolute;\n  display: inline-block;\n  content: ' ' !important;\n  left: calc(50% - 20px);\n  top: calc(50% - 40px);\n  width: 40px;\n  height: 40px;\n  background: url('./../../assets/icons/icon_upload@2x.png') center center\n    no-repeat;\n  background-size: 20px;\n}\n</style>\n<style lang=\"scss\">\n// .el-form-item__error {\n//   top: 90%;\n// }\n.addBrand-container {\n  .avatar-uploader .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n  }\n\n  .avatar-uploader .el-upload:hover {\n    border-color: #ffc200;\n  }\n\n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 200px;\n    height: 160px;\n    line-height: 160px;\n    text-align: center;\n  }\n\n  .avatar {\n    width: 200px;\n    height: 160px;\n    display: block;\n  }\n\n  // .el-form--inline .el-form-item__content {\n  //   width: 293px;\n  // }\n\n  .el-input {\n    width: 293px;\n  }\n\n  .address {\n    .el-form-item__content {\n      width: 777px !important;\n    }\n  }\n  .el-input__prefix {\n    top: 2px;\n  }\n\n  .addDish {\n    .el-input {\n      width: 130px;\n    }\n\n    .el-input-number__increase {\n      border-left: solid 1px #fbe396;\n      background: #fffbf0;\n    }\n\n    .el-input-number__decrease {\n      border-right: solid 1px #fbe396;\n      background: #fffbf0;\n    }\n\n    input {\n      border: 1px solid #fbe396;\n    }\n\n    .table {\n      border: solid 1px #ebeef5;\n      border-radius: 3px;\n\n      th {\n        padding: 5px 0;\n      }\n\n      td {\n        padding: 7px 0;\n      }\n    }\n  }\n\n  .addDishList {\n    .seachDish {\n      position: absolute;\n      top: 12px;\n      right: 20px;\n    }\n\n    .el-dialog__footer {\n      padding-top: 27px;\n    }\n\n    .el-dialog__body {\n      padding: 0;\n      border-bottom: solid 1px #efefef;\n    }\n    .seachDish {\n      .el-input__inner {\n        height: 40px;\n        line-height: 40px;\n      }\n    }\n  }\n}\n</style>\n<style lang=\"scss\" scoped>\n.addBrand {\n  &-container {\n    margin: 30px;\n\n    .container {\n      position: relative;\n      z-index: 1;\n      background: #fff;\n      padding: 30px;\n      border-radius: 4px;\n      min-height: 500px;\n\n      .subBox {\n        padding-top: 30px;\n        text-align: center;\n        border-top: solid 1px $gray-5;\n      }\n      .el-input {\n        width: 350px;\n      }\n      .addDish {\n        width: 777px;\n\n        .addBut {\n          background: #ffc200;\n          display: inline-block;\n          padding: 0px 20px;\n          border-radius: 3px;\n          line-height: 40px;\n          cursor: pointer;\n          border-radius: 4px;\n          color: #333333;\n          font-weight: 500;\n        }\n\n        .content {\n          background: #fafafb;\n          padding: 20px;\n          border: solid 1px #d8dde3;\n          border-radius: 3px;\n        }\n      }\n    }\n  }\n}\n</style>\n",null]}